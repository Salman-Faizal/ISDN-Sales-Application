{% extends "base.html" %} {% block content %}
<h3>Welcome, {{ username }}</h3>
<p class="text-muted">Role: {{ role }}</p>

<div class="row mt-4 g-3">
  <div class="col-md-3">
    <div class="card shadow-sm p-4 text-center bg-white h-100">
      <i class="bi bi-box-seam text-primary fs-2 mb-2"></i>
      <h6>Total Products</h6>
      <h2>{{ total_products }}</h2>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card shadow-sm p-4 text-center bg-white h-100">
      <i class="bi bi-bag-check text-success fs-2 mb-2"></i>
      <h6>Total Orders</h6>
      <h2>{{ total_orders }}</h2>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card shadow-sm p-4 text-center bg-white h-100">
      <i class="bi bi-boxes text-warning fs-2 mb-2"></i>
      <h6>Total Product Items</h6>
      <h2>{{ total_stock }}</h2>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card shadow-sm p-4 text-center bg-white h-100">
      <i class="bi bi-truck text-info fs-2 mb-2"></i>
      <h6>Delivered</h6>
      <h2>{{ total_delivered }}</h2>
    </div>
  </div>
</div>

<div class="row mt-4 g-3">
  <div class="col-lg-8">
    <div class="card shadow-sm p-3">
      <h5 class="mb-3">Sales (Last 30 Days)</h5>
      <canvas id="salesChart" height="120"></canvas>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card shadow-sm p-3">
      <h5 class="mb-3">Top Selling Products</h5>
      <canvas id="topProductsChart" height="120"></canvas>
    </div>
  </div>
</div>

<div class="card shadow-sm p-3 mt-4">
  <h5 class="mb-3">Out of Stock Items</h5>
  <div class="table-responsive">
    <table class="table table-striped align-middle mb-0">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Image</th>
        </tr>
      </thead>
      <tbody>
        {% if out_of_stock_products %} {% for item in out_of_stock_products %}
        <tr>
          <td>{{ item[0] }}</td>
          <td>{{ item[1] }}</td>
          <td>
            {% if item[2] %}
            <img
              src="{{ url_for('static', filename='uploads/' ~ item[2]) }}"
              alt="{{ item[1] }}"
              width="50"
              height="50"
              class="rounded object-fit-cover"
            />
            {% else %}
            <span class="text-muted">N/A</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %} {% else %}
        <tr>
          <td colspan="3" class="text-center text-muted">
            No out of stock items.
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const salesLabels = {{ sales_labels | tojson }};
  const salesValues = {{ sales_values | tojson }};
  const topProductLabels = {{ top_product_labels | tojson }};
  const topProductValues = {{ top_product_values | tojson }};

  new Chart(document.getElementById('salesChart'), {
      type: 'line',
      data: {
          labels: salesLabels,
          datasets: [{
              label: 'Items Sold',
              data: salesValues,
              borderColor: '#0d6efd',
              backgroundColor: 'rgba(13, 110, 253, 0.15)',
              tension: 0.3,
              fill: true
          }]
      },
      options: {
          responsive: true,
          scales: {
              x: { ticks: { maxTicksLimit: 10 } },
              y: { beginAtZero: true }
          }
      }
  });

  new Chart(document.getElementById('topProductsChart'), {
      type: 'bar',
      data: {
          labels: topProductLabels,
          datasets: [{
              label: 'Items Sold',
              data: topProductValues,
              backgroundColor: ['#198754', '#0d6efd', '#ffc107', '#dc3545', '#6f42c1']
          }]
      },
      options: {
          indexAxis: 'y',
          responsive: true,
          scales: {
              x: { beginAtZero: true }
          }
      }
  });
</script>
{% endblock %}
