{% extends "base.html" %} {% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="mb-0">Products</h3>

  {% if role == "Admin" %}
  <a href="/add_product" class="btn btn-primary"> + Add Product </a>
  {% endif %}
</div>

<!-- PRODUCTS TABLE -->
<div class="card shadow-sm p-3 bg-white rounded-3">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Image</th>
          <th>Name</th>
          <th>Price</th>
          <th>Stock</th>
          <th width="200">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for product in products %}
        <tr>
          <td>{{ product[0] }}</td>

          <!-- IMAGE -->
          <td>
            {% if product[4] %}
            <img
              src="{{ url_for('static', filename='uploads/' + product[4]) }}"
              width="60"
              height="60"
              style="object-fit: cover; border-radius: 8px"
            />
            {% else %}
            <span class="text-muted">No Image</span>
            {% endif %}
          </td>

          <!-- NAME -->
          <td class="fw-semibold">{{ product[1] }}</td>

          <!-- PRICE -->
          <td>${{ product[2] }}</td>

          <!-- STOCK -->
          <td>
            {% if product[3] > 0 %}
            <span class="badge bg-success">{{ product[3] }}</span>
            {% else %}
            <span class="badge bg-danger">Out of Stock</span>
            {% endif %}
          </td>

          <!-- ACTIONS -->
          <td>
            {% if role == "Admin" %}
            <a
              href="/edit_product/{{ product[0] }}"
              class="btn btn-warning btn-sm"
            >
              Edit
            </a>

            <a
              href="/delete_product/{{ product[0] }}"
              class="btn btn-danger btn-sm"
              onclick="
                return confirm('Are you sure you want to delete this product?');
              "
            >
              Delete
            </a>
            {% endif %} {% if role == "Customer" %} {% if product[3] > 0 %}
            <a href="/order/{{ product[0] }}" class="btn btn-success btn-sm">
              Order
            </a>
            {% else %}
            <button class="btn btn-secondary btn-sm" disabled>
              Unavailable
            </button>
            {% endif %} {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- CUSTOMER ORDERS SECTION -->
{% if role == "Customer" %}
<div class="card shadow-sm p-3 bg-white rounded-3 mt-4">
  <h5 class="mb-3">My Orders</h5>

  <div class="table-responsive">
    <table class="table table-bordered align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Order ID</th>
          <th>Status</th>
          <th>Payment</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for order in customer_orders %}
        <tr>
          <td>{{ order[0] }}</td>

          <!-- STATUS -->
          <td>
            {% if order[1] == "Delivered" %}
            <span class="badge bg-success">Delivered</span>
            {% elif order[1] == "Shipped" %}
            <span class="badge bg-primary">Shipped</span>
            {% elif order[1] == "Processing" %}
            <span class="badge bg-info text-dark">Processing</span>
            {% elif order[1] == "Approved" %}
            <span class="badge bg-secondary">Approved</span>
            {% elif order[1] == "Rejected" %}
            <span class="badge bg-danger">Rejected</span>
            {% elif order[1] == "Cancelled" %}
            <span class="badge bg-dark">Cancelled</span>
            {% else %}
            <span class="badge bg-warning text-dark">Pending</span>
            {% endif %}
          </td>

          <!-- PAYMENT -->
          <td>
            {% if order[2] == "Paid" %}
            <span class="badge bg-success">Paid</span>
            {% else %}
            <span class="badge bg-danger">Unpaid</span>
            {% endif %}
          </td>

          <!-- PAYMENT ACTION -->
          <td>
            {% if order[1] == "Pending" %}
            <a
              href="/cancel_order/{{ order[0] }}"
              class="btn btn-outline-danger btn-sm"
              onclick="
                return confirm('Are you sure you want to cancel this order?');
              "
            >
              Cancel Order
            </a>
            {% elif order[2] == "Unpaid" %}
            <a href="/pay/{{ order[0] }}" class="btn btn-warning btn-sm">
              Pay Now
            </a>
            {% else %}
            <span class="text-muted">â€”</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %} {% endblock %}
